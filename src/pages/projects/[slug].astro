---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";

import fs from "fs";
import path from "path";
import matter from "gray-matter";
import { marked } from "marked";

export async function getStaticPaths() {
  const projectsDir = "./src/projects";
  const files = fs.readdirSync(projectsDir).filter((f) => f.endsWith(".md"));

  return files.map((file) => {
    const slug = path.basename(file, ".md"); // quita la extensi√≥n
    return { params: { slug } };
  });
}

const { slug } = Astro.params;

const mdPath = path.join("./src/projects", `${slug}.md`);
if (!fs.existsSync(mdPath)) {
  throw new Error(`Proyecto "${slug}" no encontrado`);
}

const raw = fs.readFileSync(mdPath, "utf-8");
const { data: frontmatter, content } = matter(raw);

const bodyMd =
  (frontmatter.mainText && String(frontmatter.mainText)) || content || "";
const htmlContent = marked.parse(bodyMd);

const preview = `/projects/${slug}.jpg`;
---

<BaseLayout>
  <Navbar />
  <section class="py-20 flex justify-center">
    <div class="w-full max-w-[750px] px-6">
      <a
        href="/#projects"
        class="flex items-center text-purple-400 hover:text-purple-300 neon-hover transition mb-8"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5 mr-2"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"></path>
        </svg>
        Volver
      </a>

      <h1 class="text-4xl font-bold mb-5 text-center neon-text">
        {frontmatter.title}
      </h1>

      <img
        src={preview}
        alt={frontmatter.title}
        class="w-full rounded-lg mb-6"
      />

      <div
        class="project-content prose max-w-none text-gray-200 text-justify mb-6"
        set:html={htmlContent}
      />

      {
        frontmatter.link && (
          <div class="text-center mt-6">
            <a
              href={frontmatter.link}
              target="_blank"
              class="inline-block px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-all duration-300 transform hover:scale-[1.02] neon-border"
            >
              Ver proyecto
            </a>
          </div>
        )
      }
    </div>
  </section>
  <Footer />
</BaseLayout>
